<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Malverse: Network Defense</title>
    <style>
        body { background: black; color: green; font-family: monospace; text-align: center; }
        #game { position: relative; width: 300px; height: 400px; border: 2px solid green; margin: auto; overflow: hidden; }
        .tower { position: absolute; width: 20px; height: 20px; background: green; }
        .enemy { position: absolute; width: 20px; height: 20px; background: red; }
        #score, #high-score, #leaderboard, #instructions { margin: 10px; }
        button { padding: 5px 10px; margin-top: 20px; }
        #tower-selection { margin: 20px; }
    </style>
</head>
<body>
    <h1>Malverse: Network Defense</h1>
    <div id="instructions">
        <h2>How to Play</h2>
        <p>
            1. Click the "Start Game" button to begin.<br>
            2. Choose a tower type: Basic (10 points) or Advanced (20 points).<br>
            3. Click anywhere within the game area to place towers.<br>
            4. Enemies will spawn and move downwards. Click them to defeat.<br>
            5. The game ends when you place the required towers for the level or if enemies reach the bottom.<br>
            6. Your score will be recorded, and you can see your high score at the end.<br>
            7. Try to beat your high score!
        </p>
    </div>
    <div id="game"></div>
    <div id="score">Score: 0</div>
    <div id="high-score">High Score: 0</div>
    <div id="leaderboard">
        <h2>Leaderboard</h2>
        <ul id="score-list"></ul>
    </div>
    <div id="tower-selection" style="display: none;">
        <h3>Select Tower Type:</h3>
        <button id="basic-tower">Basic Tower (10 points)</button>
        <button id="advanced-tower">Advanced Tower (20 points)</button>
    </div>
    <button id="start-btn">Start Game</button>

    <script>
        const game = document.getElementById('game');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('high-score');
        const leaderboardDisplay = document.getElementById('score-list');
        const startBtn = document.getElementById('start-btn');
        const towerSelection = document.getElementById('tower-selection');

        let score = 0;
        let highScore = localStorage.getItem('highScore') || 0;
        let level = 1;
        let towersNeeded = 5; // Towers needed to complete each level
        let enemies = [];
        let towerType = 'basic'; // Default tower type

        highScoreDisplay.innerText = `High Score: ${highScore}`;

        startBtn.onclick = () => {
            towerSelection.style.display = 'block'; // Show tower selection
        };

        document.getElementById('basic-tower').onclick = () => {
            towerType = 'basic';
            startGame();
        };

        document.getElementById('advanced-tower').onclick = () => {
            towerType = 'advanced';
            startGame();
        };

        function startGame() {
            score = 0;
            level = 1;
            towersNeeded = 5;
            enemies = [];
            scoreDisplay.innerText = `Score: ${score}`;
            game.innerHTML = ''; // Clear the game area
            towerSelection.style.display = 'none'; // Hide tower selection
            document.addEventListener('click', placeTower);
            spawnEnemies();
        }

        function placeTower(event) {
            const tower = document.createElement('div');
            tower.className = 'tower';
            tower.style.left = `${event.clientX - game.offsetLeft}px`;
            tower.style.top = `${event.clientY - game.offsetTop}px`;
            game.appendChild(tower);

            // Scoring based on tower type
            score += (towerType === 'advanced') ? 20 : 10; 
            scoreDisplay.innerText = `Score: ${score}`;

            // Check for level completion
            if (game.childElementCount >= towersNeeded) {
                level++;
                towersNeeded += 5; // Increase towers needed for next level
                alert(`Level Up! Now you need to place ${towersNeeded} towers.`);
                clearEnemies(); // Clear existing enemies for the next level
                spawnEnemies(); // Spawn new enemies
            }
        }

        function spawnEnemies() {
            const enemyInterval = setInterval(() => {
                const enemy = document.createElement('div');
                enemy.className = 'enemy';
                enemy.style.left = `${Math.random() * (game.clientWidth - 20)}px`;
                enemy.style.top = '0px';
                game.appendChild(enemy);
                enemies.push(enemy);

                // Move the enemy down
                const moveEnemy = setInterval(() => {
                    const top = parseInt(enemy.style.top);
                    if (top < game.clientHeight - 20) {
                        enemy.style.top = `${top + 2}px`;
                    } else {
                        clearInterval(moveEnemy);
                        alert('Game Over! An enemy reached the bottom.');
                        endGame();
                    }
                }, 100);

                // Check if the enemy is clicked
                enemy.onclick = function() {
                    score += 5; // Score for defeating an enemy
                    scoreDisplay.innerText = `Score: ${score}`;
                    game.removeChild(enemy);
                    enemies = enemies.filter(e => e !== enemy);
                    clearInterval(moveEnemy);
                };
            }, 2000);
        }

        function clearEnemies() {
            enemies.forEach(enemy => game.removeChild(enemy));
            enemies = [];
        }

        function endGame() {
            alert('Game Over! Your score: ' + score);
            document.removeEventListener('click', placeTower);
            startBtn.style.display = 'block'; // Show the start button again
            updateScores();
            displayLeaderboard();
        }

        function updateScores() {
            const scores = JSON.parse(localStorage.getItem('scores')) || {};
            if (!scores['Malverse Network Defense']) {
                scores['Malverse Network Defense'] = [];
            }
            scores['Malverse Network Defense'].push(score);
            localStorage.setItem('scores', JSON.stringify(scores));
        }

        function displayLeaderboard() {
            const scores = JSON.parse(localStorage.getItem('scores')) || {};
            const currentScores = scores['Malverse Network Defense'] || [];
            leaderboardDisplay.innerHTML = ''; // Clear existing leaderboard

            currentScores.sort((a, b) => b - a); // Sort scores in descending order
            currentScores.forEach((score, index) => {
                const li = document.createElement('li');
                li.innerText = `Score: ${score}`;
                leaderboardDisplay.appendChild(li);
            });
        }
    </script>
</body>
</html>
